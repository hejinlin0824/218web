{% extends 'base.html' %}

{% block title %}æ³¨å†Œè´¦å·{% endblock %}

{# ğŸ”¥ 1. éšè—ä¾§è¾¹æ  #}
{% block sidebar %}{% endblock %}

{# ğŸ”¥ 2. ä½¿ç”¨ col-12 å æ»¡å…¨å®½ #}
{% block content_container %}
<div class="col-12">
    {% block content %}
    <style>
        /* === æ³¨å†Œé¡µç¾åŒ–æ ·å¼ (ä»…æ¶‰åŠå¤–è§‚ï¼Œä¸æ”¹ç»“æ„) === */
        
        /* èƒŒæ™¯å®¹å™¨ */
        .register-wrapper {
            min-height: 85vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8f9fa;
            padding: 40px 0;
        }

        /* ä¸»å¡ç‰‡ */
        .register-card {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 1000px;
            width: 100%;
            display: flex;
            flex-wrap: wrap;
        }

        /* å·¦ä¾§å“ç‰ŒåŒº (ç»¿è‰²ç³») */
        .register-brand-side {
            background: linear-gradient(135deg, #198754 0%, #20c997 100%);
            color: white;
            padding: 3rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        /* èƒŒæ™¯è£…é¥° */
        .register-brand-side::before {
            content: ""; position: absolute; top: -50px; left: -50px; width: 200px; height: 200px;
            background: rgba(255,255,255,0.1); border-radius: 50%;
        }
        .register-brand-side::after {
            content: ""; position: absolute; bottom: -50px; right: -50px; width: 150px; height: 150px;
            background: rgba(255,255,255,0.1); border-radius: 50%;
        }

        /* å³ä¾§è¡¨å•åŒº */
        .register-form-side {
            padding: 3rem;
            background: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* å·¦ä¾§ç‰¹æ€§å¡ç‰‡ç¾åŒ– */
        .feature-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            color: white;
            display: flex;
            align-items: center;
            transition: transform 0.2s;
        }
        .feature-card:hover {
            transform: translateX(5px);
            background: rgba(255,255,255,0.25);
        }
        .feature-icon {
            font-size: 1.5rem;
            margin-right: 15px;
            width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            .register-brand-side { display: none; }
            .register-form-side { padding: 2rem; }
        }
    </style>

    <div class="register-wrapper">
        <div class="register-card">
            
            <div class="col-md-5 register-brand-side">
                <h1 class="display-4 fw-bold mb-3">Join Us!</h1>
                <p class="lead mb-5 opacity-90">
                    æˆä¸º Web 218 å®éªŒå®¤çš„ä¸€å‘˜ã€‚
                </p>
                
                <div class="feature-card">
                    <div class="feature-icon">ğŸš€</div>
                    <div>
                        <h6 class="fw-bold mb-0">å¿«é€Ÿæˆé•¿</h6>
                        <small class="opacity-75">è·å–æœ€æ–°å‰æ²¿èµ„è®¯</small>
                    </div>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">ğŸ›¡ï¸</div>
                    <div>
                        <h6 class="fw-bold mb-0">å®‰å…¨éšç§</h6>
                        <small class="opacity-75">æˆ‘ä»¬è¦å…ˆéªŒè¯é‚®ç®±æ‰èƒ½åŠ å…¥å“¦</small>
                    </div>
                </div>
            </div>

            <div class="col-md-7 register-form-side">
                
                <div class="text-center mb-4">
                    <h3 class="fw-bold text-success">ğŸ“ åˆ›å»ºæ–°è´¦å·</h3>
                </div>

                <form method="post">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                        <div class="alert alert-danger small border-0 shadow-sm rounded-3">
                            {{ form.non_field_errors }}
                            {% for field in form %}
                                {% if field.errors %}
                                    <div><strong>{{ field.label }}:</strong> {{ field.errors.0 }}</div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}

                    {% for field in form %}
                        <div class="form-floating mb-3" id="div_{{ field.name }}" 
                             style="{% if field.name == 'student_id' %}display:none;{% endif %}">
                            
                            {# ğŸ”¥ å…³é”®ç‚¹ï¼šç›´æ¥ä½¿ç”¨ {{ field }}ï¼Œä¸æ‰‹å†™ inputï¼Œé˜²æ­¢åŒé‡è¾“å…¥æ¡† #}
                            {# åç»­é€šè¿‡ JS è‡ªåŠ¨ç»™å®ƒåŠ ä¸Š class="form-control" ä»¥é€‚é…æ ·å¼ #}
                            {{ field }}
                            
                            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                            
                            {% if field.help_text %}
                                <div class="form-text small ms-1">{{ field.help_text }}</div>
                            {% endif %}
                        </div>
                    {% endfor %}

                    <div class="d-grid gap-2 mt-4 mb-4">
                        <button type="submit" class="btn btn-success btn-lg rounded-pill shadow-sm fw-bold">
                            ç«‹å³æ³¨å†Œ
                        </button>
                    </div>

                    <div class="text-center small text-muted">
                        å·²æœ‰è´¦å·ï¼Ÿ 
                        <a href="{% url 'user_app:login' %}" class="fw-bold text-decoration-none text-success">ç›´æ¥ç™»å½•</a>
                    </div>
                </form>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // === 1. æ ·å¼è¡¥ä¸ ===
            // è‡ªåŠ¨ç»™ Django ç”Ÿæˆçš„ input/select æ·»åŠ  Bootstrap ç±»ï¼Œ
            // è¿™æ ·æ—¢ä¿ç•™äº† {{ field }} çš„åŸå§‹é€»è¾‘ï¼Œåˆèƒ½æ‹¥æœ‰ form-floating çš„æ¼‚äº®æ ·å¼
            const inputs = document.querySelectorAll('.register-form-side input, .register-form-side select');
            inputs.forEach(el => {
                el.classList.add('form-control');
                el.classList.add('bg-light'); // å¢åŠ æµ…ç°èƒŒæ™¯
                el.classList.add('border-0'); // å»æ‰é»˜è®¤è¾¹æ¡†
                
                // form-floating éœ€è¦ placeholder æ‰èƒ½å·¥ä½œ (è™½ç„¶è§†è§‰ä¸Šå¯èƒ½ä¸æ˜¾ç¤º)
                if (!el.getAttribute('placeholder')) {
                    el.setAttribute('placeholder', 'Input');
                }
            });

            // === 2. ä½ çš„åŸå§‹ä¸šåŠ¡é€»è¾‘ (ä¿ç•™) ===
            const statusSelect = document.getElementById('id_status');
            const studentIdDiv = document.getElementById('div_student_id');
            const studentIdInput = document.getElementById('id_student_id');

            function toggleStudentId() {
                if (statusSelect && statusSelect.value === 'student') {
                    studentIdDiv.style.display = 'block';
                    // åŠ ä¸€ç‚¹ç‚¹æ·¡å…¥åŠ¨ç”»
                    studentIdDiv.style.opacity = 0;
                    studentIdDiv.style.transition = 'opacity 0.3s';
                    setTimeout(() => studentIdDiv.style.opacity = 1, 50);
                    
                    if(studentIdInput) studentIdInput.required = true; 
                } else {
                    if(studentIdDiv) studentIdDiv.style.display = 'none';
                    if(studentIdInput) {
                        studentIdInput.value = ''; 
                        studentIdInput.required = false;
                    }
                }
            }

            if(statusSelect) {
                toggleStudentId();
                statusSelect.addEventListener('change', toggleStudentId);
            }
        });
    </script>
    {% endblock %}
</div>
{% endblock %}