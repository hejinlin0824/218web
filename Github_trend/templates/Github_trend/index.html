{% extends 'base.html' %}

{% block title %}GitHub è¶‹åŠ¿ - ç¬¬ {{ current_page }} é¡µ{% endblock %}

{% block content %}
<div class="row mb-4 align-items-end">
    <div class="col-md-6">
        <h2>ğŸ”¥ å¼€æºçƒ­æ¦œ</h2>
        <p class="text-muted small mb-0">å‘ç° GitHub ä¸Šæœ€å—å…³æ³¨çš„é¡¹ç›®</p>
    </div>
    
    <div class="col-md-6">
        <form method="get" class="row g-2 justify-content-md-end">
            <div class="col-auto">
                <select name="lang" class="form-select" onchange="this.form.submit()">
                    {% for lang in language_options %}
                        <option value="{{ lang }}" {% if current_lang == lang %}selected{% endif %}>
                            {{ lang|title }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-auto">
                <select name="period" class="form-select" onchange="this.form.submit()">
                    <option value="daily" {% if current_period == 'daily' %}selected{% endif %}>ä»Šæ—¥æœ€çƒ­</option>
                    <option value="weekly" {% if current_period == 'weekly' %}selected{% endif %}>æœ¬å‘¨æœ€çƒ­</option>
                    <option value="monthly" {% if current_period == 'monthly' %}selected{% endif %}>æœ¬æœˆæœ€çƒ­</option>
                </select>
            </div>
            
            </form>
    </div>
</div>

<div class="row">
    {% for repo in repos %}
    <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm hover-effect">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <img src="{{ repo.avatar }}" class="rounded-circle me-2 border" width="45" height="45">
                    <div style="overflow: hidden;">
                        <h6 class="card-title text-truncate mb-0" title="{{ repo.full_name }}">
                            <a href="{{ repo.url }}" target="_blank" class="text-decoration-none text-dark">{{ repo.name }}</a>
                        </h6>
                        <small class="text-muted">{{ repo.updated_at }}</small>
                    </div>
                </div>
                
                <div class="mb-3">
                    <span class="badge bg-warning text-dark">â­ {{ repo.stars }}</span>
                    <span class="badge bg-light text-dark border ms-1">{{ repo.language|default:"Unknown" }}</span>
                </div>
                
                <p class="card-text small text-secondary" style="height: 60px; overflow: hidden;">
                    {{ repo.description|default:"æš‚æ— æè¿°"|truncatechars:80 }}
                </p>
            </div>
            <div class="card-footer bg-white border-top-0">
                <a href="{{ repo.url }}" target="_blank" class="btn btn-sm btn-outline-primary w-100">æŸ¥çœ‹æºç </a>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12 text-center py-5">
        <div class="alert alert-warning">
            <h4>ğŸ¤” æš‚æ— æ•°æ®</h4>
            <p>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„é¡¹ç›®ï¼Œæˆ–è€… GitHub API è¯·æ±‚è¶…æ—¶ã€‚</p>
            <a href="?lang=python&period=weekly" class="btn btn-primary mt-2">é‡ç½®ç­›é€‰</a>
        </div>
    </div>
    {% endfor %}
</div>

<nav aria-label="Page navigation" class="mt-4 mb-5">
  <ul class="pagination justify-content-center">
    {% if prev_page %}
    <li class="page-item">
      <a class="page-link" href="?lang={{ current_lang }}&period={{ current_period }}&page={{ prev_page }}">
        &laquo; ä¸Šä¸€é¡µ
      </a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">&laquo; ä¸Šä¸€é¡µ</span></li>
    {% endif %}

    <li class="page-item active">
        <span class="page-link">ç¬¬ {{ current_page }} é¡µ</span>
    </li>

    <li class="page-item">
      <a class="page-link" href="?lang={{ current_lang }}&period={{ current_period }}&page={{ next_page }}">
        ä¸‹ä¸€é¡µ &raquo;
      </a>
    </li>
  </ul>
</nav>
{% endblock %}